<!DOCTYPE html>
<html ng-app="app">
<head>
  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  <link href="css/app.css" rel="stylesheet">
</head>
<body>
<div class="navbar navbar-inverse" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">
        <img src="css/images/logo.png">
        Asgard
      </a>
    </div>
  </div>
</div>
<div class="navbar" id="globalnav" role="global">
  <div class="container-fluid">
    <ul class="nav navbar-nav">
      <li><a href="#" id="app-nav">Apps</a></li>
      <li><a href="#" id="cluster-nav">Clusters</a></li>
    </ul>
  </div>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12" ng-view=""></div>
  </div>
</div>

<script src="http://momentjs.com/downloads/moment.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-route.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-resource.min.js"></script>

<script>
  var app = angular.module("app", ["ngRoute", "ngResource"]);
  app.config(['$routeProvider', function($routeProvider) {
    $routeProvider.when('/', {
      templateUrl: 'partials/landing.html',
      controller: LandingPageController
    }).when('/:deployable/clusters/:cluster?', {
      templateUrl: 'partials/clusters.html',
      controller: ClusterController
    }).when('/:deployable/clusters/:cluster/asgs/:asg', {
      templateUrl: 'partials/asg.html',
      controller: AsgController
    })
    .otherwise('/')
  }]);

  function LandingPageController($scope, $location, $resource) {
    var DeployableResource = $resource("/deployables");

    var deployables = DeployableResource.get(function() {
      $scope.deployables = deployables;
    });

    $scope.go = function(deployable) {
      $location.path('/'+deployable+'/clusters');
    };

    $scope.splitTags = function(tags) {
      if (tags) {
        return tags.split(",");
      } else {
        return [];
      }
    };

    $scope.toAgo = function(input) {
      if (!input) {
        return "";
      }
      return moment(parseInt(input)).fromNow();
    }
  }

  function ClusterController($scope, $routeParams, $resource) {
    var ClusterResource = $resource("/deployables/:deployable/clusters/:cluster");
    $scope.deployable = $routeParams.deployable;
    $scope.cluster = $routeParams.cluster;
    var asgs = ClusterResource.query({deployable: $routeParams.deployable, cluster: $routeParams.cluster}, function () {
      $scope.asgs = asgs;
    });

    $scope.toAgo = function(input) {
      if (!input) {
        return "";
      }
      return moment(parseInt(input)).fromNow();
    }
  }

  function AsgController($scope, $routeParams, $resource) {
    var AsgResource = $resource("/deployables/:deployable/clusters/:cluster/asgs/:asg");
    $scope.deployable = $routeParams.deployable;
    $scope.cluster = $routeParams.cluster;
    var asg = AsgResource.get({deployable: $routeParams.deployable, cluster: $routeParams.cluster, asg: $routeParams.asg}, function() {
      $scope.asg = asg;
    });

    $scope.toAgo = function(input) {
      if (!input) {
        return "";
      }
      return moment(parseInt(input)).fromNow();
    }
  }

</script>
</body>
</html>